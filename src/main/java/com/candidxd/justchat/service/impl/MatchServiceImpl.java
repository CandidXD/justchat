package com.candidxd.justchat.service.impl;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;import com.alibaba.fastjson.TypeReference;import com.candidxd.justchat.bean.Customer;import com.candidxd.justchat.bean.Match;import com.candidxd.justchat.dao.BaseDao;import com.candidxd.justchat.dao.MatchDao;import com.candidxd.justchat.redis.JedisUtil;import com.candidxd.justchat.service.MatchService;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.Set;/** * @author yzk * @Title: CustomerServiceImpl * @ProjectName demo * @Description: TODO * @date 2018/8/2111:24 */@Service(value = "matchServiceImpl")public class MatchServiceImpl extends BaseServiceImpl<Match> implements MatchService {    @Autowired    private JedisUtil jedisUtil;    @Autowired    private MatchDao matchDao;    @Override    public Logger logger() {        return LoggerFactory.getLogger(BaseServiceImpl.class);    }    @Override    public BaseDao<Match> getMainDao() {        return matchDao;    }    @Override    public void add(Match match) {        super.add(match);        jedisUtil.set(match.getCustomerUid1() + ":" + match.getCustomerUid2(), JSONObject.toJSONString(match));    }    @Override    public void update(Match match) {        super.update(match);        jedisUtil.set(match.getCustomerUid1() + ":" + match.getCustomerUid2(), JSONObject.toJSONString(match));    }    @Override    public void delete(Match match) {        super.delete(match);        jedisUtil.delete(match.getCustomerUid1() + ":" + match.getCustomerUid2());    }    @Override    public Match match(Customer customer) {        Set<String> set = jedisUtil.keys("*" + customer.getUid() + "*");        String key = null;        if (set.size() > 0) {            for (String k : set) {                key = k;                if (!key.equals(CustomerStatusServiceImpl.class.getName() + customer.getUid())) {                    String value = jedisUtil.get(key);                    Match bean = JSON.parseObject(value, new TypeReference<Match>() {                    });                    if (bean.getEndTime().equals("1970-01-01 00:00:00")) {                        return bean;                    }                }            }        }        return null;        // jedisUtil.get(match.getCustomerUid1() + "_" + match.getCustomerUid2(), JSONObject.toJSONString(match));        // return matchDao.match(customer);    }}